<%- include('../../partials/header', { title: 'Students Management' }) %>

<section class="section">
  <div class="container">

    <!-- Header / Actions -->
    <div class="level mb-5">
      <div class="level-left">
        <h2 class="title is-3">
          <span class="icon"><i class="mdi mdi-account-group"></i></span>
          <span>Students Management</span>
        </h2>
      </div>
      <div class="level-right">
        <a href="/admin/students/add" class="button is-primary">
          <span class="icon"><i class="mdi mdi-account-plus"></i></span>
          <span>Add New Student</span>
        </a>
      </div>
    </div>

    <!-- Filters -->
    <div class="box">
      <form method="GET" action="/admin/students">
        <div class="columns is-multiline is-variable is-3">
          <div class="column is-one-third">
            <div class="field">
              <label class="label">Filter by Class</label>
              <div class="control">
                <div class="select is-fullwidth">
                  <select name="class_id" id="class_id">
                    <option value="">All Classes</option>
                    <% classes.forEach(cls => { %>
                      <option value="<%= cls.id %>" <%= filters.class_id == cls.id ? 'selected' : '' %>>
                        <%= cls.name %>
                      </option>
                    <% }) %>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="column is-one-third">
            <div class="field">
              <label class="label">Search</label>
              <div class="control has-icons-left">
                <input
                  class="input"
                  type="text"
                  id="search"
                  name="search"
                  placeholder="Name or Admission No."
                  value="<%= filters.search || '' %>"
                >
                <span class="icon is-left"><i class="mdi mdi-magnify"></i></span>
              </div>
            </div>
          </div>

          <div class="column is-one-third">
            <div class="field is-grouped is-justify-content-flex-end mt-5">
              <div class="control">
                <button type="submit" class="button is-primary">
                  <span class="icon"><i class="mdi mdi-filter"></i></span>
                  <span>Filter</span>
                </button>
              </div>
              <div class="control">
                <a href="/admin/students" class="button is-light">
                  <span class="icon"><i class="mdi mdi-close-circle"></i></span>
                  <span>Clear</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!-- Students Table -->
    <div class="box">
      <div class="level mb-3">
        <div class="level-left">
          <h5 class="title is-5">
            <span class="icon"><i class="mdi mdi-format-list-bulleted"></i></span>
            <span>Students List</span>
          </h5>
        </div>
        <div class="level-right">
          <span class="tag is-primary is-medium"><%= students.length %></span>
        </div>
      </div>

      <% if (students.length > 0) { %>
        <div class="table-container">
          <table class="table is-striped is-hoverable is-fullwidth">
            <thead>
              <tr>
                <th>Admission No.</th>
                <th>Name</th>
                <th>Gender</th>
                <th>Class</th>
                <th>Parent Email</th>
                <th>Parent Phone</th>
                <th class="has-text-centered">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% students.forEach(student => { %>
                <tr>
                  <td><strong><%= student.admission_number %></strong></td>
                  <td>
                    <%= student.first_name %> <%= student.middle_name || '' %> <%= student.last_name %>
                  </td>
                  <td><%= student.gender %></td>
                  <td>
                    <% if (student.class_name) { %>
                      <span class="tag is-info is-light"><%= student.class_name %></span>
                    <% } else { %>
                      <span class="tag is-light">No Class</span>
                    <% } %>
                  </td>
                  <td><%= student.parent_email || 'N/A' %></td>
                  <td><%= student.parent_phone || 'N/A' %></td>
                  <td class="has-text-centered">
                    <div class="buttons are-small is-centered">
                      <a href="/admin/students/edit/<%= student.id %>" class="button is-info is-light" title="Edit">
                        <span class="icon"><i class="mdi mdi-pencil"></i></span>
                      </a>
                      <form action="/admin/students/delete/<%= student.id %>" method="POST" style="display: inline;">
                        <button type="submit" class="button is-danger is-light"
                          onclick="return confirm('Are you sure you want to delete this student?')" title="Delete">
                          <span class="icon"><i class="mdi mdi-delete-outline"></i></span>
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="has-text-centered py-6">
          <span class="icon is-large has-text-grey-light" style="font-size: 3rem;">
            <i class="mdi mdi-inbox"></i>
          </span>
          <p class="has-text-grey mt-3">No students found.</p>
          <a href="/admin/students/add" class="button is-primary mt-3">
            <span class="icon"><i class="mdi mdi-account-plus"></i></span>
            <span>Add Your First Student</span>
          </a>
        </div>
      <% } %>
    </div>
  </div>
</section>

<%- include('../../partials/footer') %>
