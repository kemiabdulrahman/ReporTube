<%- include('../../partials/header', { title: classData.name + ' Details' }) %>

<section class="section">
  <div class="container">

    <!-- Header -->
    <div class="level mb-5">
      <div class="level-left">
        <h2 class="title is-3">
          <span class="icon"><i class="mdi mdi-google-classroom"></i></span>
          <span><%= classData.name %> Details</span>
        </h2>
      </div>
      <div class="level-right">
        <a href="/admin/classes" class="button is-light">
          <span class="icon"><i class="mdi mdi-arrow-left"></i></span>
          <span>Back to Classes</span>
        </a>
      </div>
    </div>

    <!-- Class Info -->
    <div class="box">
      <h4 class="title is-5 mb-4">
        <span class="icon"><i class="mdi mdi-information-outline"></i></span>
        <span>Class Information</span>
      </h4>

      <div class="columns is-multiline">
        <div class="column is-one-third">
          <p><strong>Name:</strong> <%= classData.name %></p>
        </div>
        <div class="column is-one-third">
          <p><strong>Level:</strong> <%= classData.level %></p>
        </div>
        <div class="column is-one-third">
          <p><strong>Academic Year:</strong> <%= classData.academic_year %></p>
        </div>
      </div>
    </div>

    <!-- Assigned Teachers -->
    <div class="box">
      <div class="level mb-4">
        <div class="level-left">
          <h4 class="title is-5">
            <span class="icon"><i class="mdi mdi-account-tie"></i></span>
            <span>Assigned Teachers</span>
          </h4>
        </div>
      </div>

      <% if (teachers && teachers.length > 0) { %>
        <div class="table-container">
          <table class="table is-striped is-fullwidth is-hoverable">
            <thead>
              <tr>
                <th>Teacher Name</th>
                <th>Subject</th>
                <th>Academic Year</th>
                <th class="has-text-centered">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% teachers.forEach(teacher => { %>
                <tr>
                  <td><%= teacher.full_name %></td>
                  <td><%= teacher.subject_name %></td>
                  <td><%= teacher.academic_year %></td>
                  <td class="has-text-centered">
                    <form action="/admin/classes/<%= classData.id %>/remove-teacher" method="POST" style="display: inline;">
                      <input type="hidden" name="teacher_id" value="<%= teacher.teacher_id %>">
                      <input type="hidden" name="subject_id" value="<%= teacher.subject_id %>">
                      <button type="submit" class="button is-danger is-light is-small"
                        onclick="return confirm('Remove this teacher from the class?')">
                        <span class="icon"><i class="mdi mdi-trash-can-outline"></i></span>
                      </button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <p class="has-text-grey-light">No teachers assigned yet.</p>
      <% } %>

      <!-- Assign Teacher Form -->
      <div class="mt-5">
        <h5 class="title is-6">Assign a New Teacher</h5>
        <form action="/admin/classes/<%= classData.id %>/assign-teacher" method="POST">
          <div class="columns is-multiline">
            <div class="column is-one-third">
              <div class="field">
                <label class="label">Teacher</label>
                <div class="control">
                  <div class="select is-fullwidth">
                    <select name="teacher_id" required>
                      <option value="">Select Teacher</option>
                      <% allTeachers.forEach(t => { %>
                        <option value="<%= t.id %>"><%= t.full_name %></option>
                      <% }) %>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="column is-one-third">
              <div class="field">
                <label class="label">Subject</label>
                <div class="control">
                  <div class="select is-fullwidth">
                    <select name="subject_id" required>
                      <option value="">Select Subject</option>
                      <% subjects.forEach(sub => { %>
                        <option value="<%= sub.id %>"><%= sub.name %></option>
                      <% }) %>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="column is-one-third">
              <div class="field">
                <label class="label">Academic Year</label>
                <div class="control has-icons-left">
                  <input
                    class="input"
                    type="text"
                    name="academic_year"
                    value="<%= classData.academic_year %>"
                    required>
                  <span class="icon is-left"><i class="mdi mdi-calendar"></i></span>
                </div>
              </div>
            </div>
          </div>

          <div class="field">
            <div class="control">
              <button type="submit" class="button is-primary">
                <span class="icon"><i class="mdi mdi-plus-circle-outline"></i></span>
                <span>Assign Teacher</span>
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Students Section -->
    <div class="box">
      <h4 class="title is-5 mb-4">
        <span class="icon"><i class="mdi mdi-account-group-outline"></i></span>
        <span>Students in this Class</span>
      </h4>

      <% if (students && students.length > 0) { %>
        <div class="table-container">
          <table class="table is-striped is-fullwidth is-hoverable">
            <thead>
              <tr>
                <th>Admission No.</th>
                <th>Name</th>
                <th>Gender</th>
                <th>Parent Email</th>
                <th>Parent Phone</th>
              </tr>
            </thead>
            <tbody>
              <% students.forEach(student => { %>
                <tr>
                  <td><strong><%= student.admission_number %></strong></td>
                  <td><%= student.first_name %> <%= student.middle_name || '' %> <%= student.last_name %></td>
                  <td><%= student.gender %></td>
                  <td><%= student.parent_email || 'N/A' %></td>
                  <td><%= student.parent_phone || 'N/A' %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <p class="has-text-grey-light">No students enrolled in this class yet.</p>
      <% } %>
    </div>

  </div>
</section>

<%- include('../../partials/footer') %>
